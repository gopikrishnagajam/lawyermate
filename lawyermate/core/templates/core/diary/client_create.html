{% extends 'core/base.html' %}

{% block title %}Add New Client - LawyerMate{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'diary_dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'client_list' %}">Clients</a></li>
                    <li class="breadcrumb-item active">Add New Client</li>
                </ol>
            </nav>
            <h2>üë§ Add New Client</h2>
            <p class="text-muted mb-0">Add a new client to your directory</p>
        </div>
    </div>

    <!-- Add Client Form -->
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body">
                    <form method="post" id="clientCreateForm">
                        {% csrf_token %}
                        
                        <h5 class="mb-4">üìù Client Information</h5>
                        
                        <!-- Basic Information -->
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" required 
                                       placeholder="Enter client's full name">
                            </div>
                            <div class="col-md-4">
                                <label for="occupation" class="form-label">Occupation</label>
                                <input type="text" class="form-control" id="occupation" name="occupation" 
                                       placeholder="e.g., Engineer, Doctor">
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="phone" name="phone" required 
                                       placeholder="+91 9876543210" pattern="[0-9+\-\s]+">
                                <small class="form-text text-muted">Include country code for international numbers</small>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       placeholder="client@example.com">
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="mb-3">
                            <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="address" name="address" rows="3" required 
                                      placeholder="Complete address with pincode"></textarea>
                        </div>

                        <!-- Government IDs -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="aadhar_number" class="form-label">Aadhar Card Number</label>
                                <input type="text" class="form-control" id="aadhar_number" name="aadhar_number" 
                                       placeholder="1234 5678 9012" maxlength="14" pattern="[0-9\s]+">
                                <small class="form-text text-muted">12-digit Aadhar number (optional but recommended)</small>
                            </div>
                            <div class="col-md-6">
                                <label for="pan_number" class="form-label">PAN Card Number</label>
                                <input type="text" class="form-control" id="pan_number" name="pan_number" 
                                       placeholder="ABCDE1234F" maxlength="10" style="text-transform: uppercase;">
                                <small class="form-text text-muted">10-character PAN number</small>
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="mb-4">
                            <label for="notes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="4" 
                                      placeholder="Any additional information about the client (family details, preferences, previous legal history, etc.)"></textarea>
                            <small class="form-text text-muted">Confidential notes for internal use only</small>
                        </div>

                        <!-- Information Box -->
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle"></i> Client Privacy & Data Protection</h6>
                            <ul class="mb-0 small">
                                <li>All client information is stored securely and confidentially</li>
                                <li>Only you can access your clients' data</li>
                                <li>Government ID numbers are optional but help in case documentation</li>
                                <li>You can edit or update client information anytime</li>
                            </ul>
                        </div>

                        <hr>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'client_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Cancel
                            </a>
                            <div>
                                <button type="submit" class="btn btn-success me-2" name="action" value="save_and_add_case">
                                    <i class="fas fa-plus"></i> Save & Create Case
                                </button>
                                <button type="submit" class="btn btn-primary" name="action" value="save">
                                    <i class="fas fa-check"></i> Save Client
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Quick Guide Sidebar -->
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0"><i class="fas fa-lightbulb"></i> Client Management Tips</h6>
                </div>
                <div class="card-body">
                    <h6>Essential Information:</h6>
                    <ul class="small">
                        <li><strong>Full Name:</strong> As per legal documents</li>
                        <li><strong>Phone:</strong> Primary contact number</li>
                        <li><strong>Address:</strong> Current residential address</li>
                        <li><strong>Aadhar/PAN:</strong> For court documentation</li>
                    </ul>
                    
                    <h6 class="mt-3">Best Practices:</h6>
                    <ul class="small">
                        <li>Verify phone numbers before saving</li>
                        <li>Keep emergency contact details</li>
                        <li>Note client preferences in notes</li>
                        <li>Update information regularly</li>
                    </ul>
                    
                    <h6 class="mt-3">After Adding Client:</h6>
                    <ul class="small mb-0">
                        <li>Create their first legal case</li>
                        <li>Set up hearing reminders</li>
                        <li>Upload relevant documents</li>
                        <li>Track fee payments</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Format Aadhar number input
    const aadharInput = document.getElementById('aadhar_number');
    aadharInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/g, '');
        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
        e.target.value = formattedValue.substring(0, 14); // 12 digits + 2 spaces
    });
    
    // Format PAN number input
    const panInput = document.getElementById('pan_number');
    panInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '').substring(0, 10);
    });
    
    // Phone number validation
    const phoneInput = document.getElementById('phone');
    phoneInput.addEventListener('input', function(e) {
        // Allow only numbers, +, -, and spaces
        e.target.value = e.target.value.replace(/[^0-9+\-\s]/g, '');
    });
    
    // Form validation
    document.getElementById('clientCreateForm').addEventListener('submit', function(e) {
        const requiredFields = ['name', 'phone', 'address'];
        let isValid = true;
        
        requiredFields.forEach(fieldName => {
            const field = document.getElementById(fieldName);
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        // Validate phone number length
        const phone = document.getElementById('phone').value.replace(/[^0-9]/g, '');
        if (phone.length < 10) {
            document.getElementById('phone').classList.add('is-invalid');
            isValid = false;
        }
        
        // Validate Aadhar if provided
        const aadhar = document.getElementById('aadhar_number').value.replace(/\s/g, '');
        if (aadhar && aadhar.length !== 12) {
            document.getElementById('aadhar_number').classList.add('is-invalid');
            isValid = false;
        }
        
        // Validate PAN if provided
        const pan = document.getElementById('pan_number').value;
        if (pan && !/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(pan)) {
            document.getElementById('pan_number').classList.add('is-invalid');
            isValid = false;
        }
        
        if (!isValid) {
            e.preventDefault();
            alert('Please correct the highlighted fields and try again.');
        }
    });
    
    // Clear validation on input
    document.querySelectorAll('.form-control').forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('is-invalid');
        });
    });
});
</script>

<style>
.form-label {
    font-weight: 600;
}

.form-text {
    font-size: 0.875rem;
}

.is-invalid {
    border-color: #dc3545;
}

.alert-info {
    background-color: #e7f3ff;
    border-color: #bee5eb;
}

.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}
</style>
{% endblock %}